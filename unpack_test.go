package dns

import (
	"net"
	"testing"
)

func TestUnpack(t *testing.T) {
	b := []byte{0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
		0x3, 0x77, 0x77, 0x77,
		0x8, 0x73, 0x65, 0x6b, 0x69, 0x6d, 0x75, 0x72, 0x61,
		0x3, 0x6f, 0x72, 0x67,
		0x0,
		0x0, 0x1, 0x0, 0x1}

	_, err := Unpack(b)
	if err != nil {
		t.Error(err)
	}

	b = []byte{0xe4, 0x3f, 0x81, 0x80, 0x0, 0x1, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0,
		0x3, 0x77, 0x77, 0x77, 0x8, 0x73, 0x65, 0x6b, 0x69, 0x6d, 0x75, 0x72, 0x61,
		0x3, 0x6f, 0x72, 0x67, 0x0, 0x0, 0x1, 0x0, 0x1, 0xc0, 0xc, 0x0, 0x1, 0x0,
		0x1, 0x0, 0x0, 0x8, 0xef, 0x0, 0x4, 0xad, 0xff, 0xf8, 0xc5}
	msg, err := Unpack(b)
	if err != nil {
		t.Error(err)
	}
	if int(msg.Header.ANcount) != len(msg.Answer) {
		t.Error("got wrong answer number")
	}
	if int(msg.Answer[0].RDLength) != 4 {
		t.Error("got wrong rd length")
	}
	ip, ok := msg.Answer[0].RData.(net.IP)
	if !ok {
		t.Error("got wrong RData", ip)
	}
	if ip.String() != "173.255.248.197" {
		t.Error("got wrong RData", ip.String())
	}

}
